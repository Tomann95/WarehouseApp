@model IEnumerable<WarehouseApp.Models.WarehouseDocument>
@using System.Linq
@using WarehouseApp.Models.Enums

@{
    ViewData["Title"] = "Raport dokumentów magazynowych";

    DateTime? fromDate = ViewBag.FromDate as DateTime?;
    DateTime? toDate = ViewBag.ToDate as DateTime?;
    DocumentType? selectedType = ViewBag.DocumentType != null
        ? (DocumentType)ViewBag.DocumentType
        : (DocumentType?)null;
    int? selectedPartnerId = ViewBag.BusinessPartnerId as int?;
    int? selectedLocationId = ViewBag.LocationId as int?;
    string documentNumber = ViewBag.DocumentNumber as string;
}

<h1 class="mt-3">Raport dokumentów magazynowych</h1>

<form asp-action="WarehouseDocument" asp-controller="Reports" method="get" class="mb-4">
    <div class="row g-3">

        <div class="col-md-2">
            <label class="form-label">Od daty</label>
            <input type="date"
                   name="fromDate"
                   class="form-control"
                   value="@(fromDate.HasValue ? fromDate.Value.ToString("yyyy-MM-dd") : "")" />
        </div>

        <div class="col-md-2">
            <label class="form-label">Do daty</label>
            <input type="date"
                   name="toDate"
                   class="form-control"
                   value="@(toDate.HasValue ? toDate.Value.ToString("yyyy-MM-dd") : "")" />
        </div>

        <div class="col-md-2">
            <label class="form-label">Typ dokumentu</label>

            <select name="documentType" class="form-select">
                <option value="">--- wszystkie ---</option>

                @foreach (var value in Enum.GetValues(typeof(DocumentType)).Cast<DocumentType>())
                {
                    if (selectedType.HasValue && selectedType.Value == value)
                    {
                        <option value="@value" selected="selected">@value</option>
                    }
                    else
                    {
                        <option value="@value">@value</option>
                    }
                }
            </select>
        </div>

        <div class="col-md-2">
            <label class="form-label">Id kontrahenta (opcjonalnie)</label>
            <input type="number"
                   name="businessPartnerId"
                   class="form-control"
                   value="@(selectedPartnerId.HasValue ? selectedPartnerId.Value.ToString() : "")" />
        </div>

        <div class="col-md-2">
            <label class="form-label">Id lokalizacji (opcjonalnie)</label>
            <input type="number"
                   name="locationId"
                   class="form-control"
                   value="@(selectedLocationId.HasValue ? selectedLocationId.Value.ToString() : "")" />
        </div>

        <div class="col-md-2">
            <label class="form-label">Numer dokumentu</label>
            <input type="text"
                   name="documentNumber"
                   class="form-control"
                   value="@(documentNumber ?? "")" />
        </div>
    </div>

    <div class="mt-3">
        <button type="submit" class="btn btn-primary me-2">Szukaj</button>
        <a asp-action="WarehouseDocument" asp-controller="Reports" class="btn btn-secondary">Wyczyść</a>
    </div>
</form>

@if (Model == null || !Model.Any())
{
    <div class="alert alert-info mt-3">
        Brak dokumentów spełniających podane kryteria.
    </div>
}
else
{
    <table class="table table-striped table-bordered mt-3">
        <thead>
            <tr>
                <th>Numer</th>
                <th>Data wystawienia</th>
                <th>Typ</th>
                <th>Kontrahent</th>
                <th>Lokalizacja źródłowa</th>
                <th>Lokalizacja docelowa</th>
                <th>Uwagi</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var d in Model)
            {
                <tr>
                    <td>@d.DocumentNumber</td>
                    <td>@d.IssueDate.ToString("yyyy-MM-dd")</td>
                    <td>@d.DocumentType</td>
                    <td>@(d.BusinessPartner != null ? d.BusinessPartner.Name : "")</td>
                    <td>@(d.SourceLocation != null ? d.SourceLocation.Code : "")</td>
                    <td>@(d.TargetLocation != null ? d.TargetLocation.Code : "")</td>
                    <td>@d.Notes</td>
                    <td>
                        <a asp-controller="WarehouseDocuments"
                           asp-action="Details"
                           asp-route-id="@d.Id"
                           class="btn btn-sm btn-outline-primary">
                            Szczegóły
                        </a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}


